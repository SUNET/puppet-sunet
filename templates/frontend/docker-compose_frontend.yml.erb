---
version: '3.6'
services:


  api:
    image: "<%= scope['sunet::frontend::load_balancer::services::api_image'] -%>:<%= scope['sunet::frontend::load_balancer::services::api_imagetag'] -%>"
    restart: always
    volumes:
      - /etc/passwd:/etc/passwd:ro
      - /etc/group:/etc/group:ro
      - "<%= scope['sunet::frontend::load_balancer::services::api_basedir'] -%>/backends:/backends"
    ports:
      - "<%= scope['sunet::frontend::load_balancer::services::api_port'] -%>:8080"

  telegraf:
    image: "<%= scope['sunet::frontend::load_balancer::services::telegraf_image'] -%>:<%= scope['sunet::frontend::load_balancer::services::telegraf_imagetag'] -%>"
    restart: always
    volumes:
      - "<%= scope['sunet::frontend::load_balancer::services::telegraf_basedir'] -%>/telegraf.conf:/etc/telegraf/telegraf.conf:ro"
<% scope['sunet::frontend::load_balancer::services::telegraf_volumes'].each do | this | -%>
      - <%= this %>
<% end -%>



networks:
  default:
    driver_opts:
      com.docker.network.bridge.name: br-frontend
