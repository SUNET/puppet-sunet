---
services:

  influxdb2:
    image: docker.sunet.se/docker-influxdb2:<%= @influxdb2_tag %>
    ports:
      - '8086:8086'
    environment:
      - SERVICENAME=<%= @servicename %>
      - DOCKER_INFLUXDB_INIT_MODE=setup
      - DOCKER_INFLUXDB_INIT_USERNAME=<%= @influxdb_init_username %>
      - DOCKER_INFLUXDB_INIT_PASSWORD=<%= @influxdb_init_password %>
      - DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=<%= @influxdb_init_admin_token %>
      - DOCKER_INFLUXDB_INIT_ORG=sunet
      - DOCKER_INFLUXDB_INIT_BUCKET=home
    volumes:
      - '/etc/letsencrypt/live/:/etc/letsencrypt/live/:ro'
      - '/etc/letsencrypt/archive:/etc/letsencrypt/archive:ro'
      - '/data:/var/lib/influxdb'
      - '/usr/local/bin/backup-influx.sh:/usr/local/bin/backup-influx.sh:ro'
      - '/etc/ssl/private/:/etc/ssl/private/:ro'
