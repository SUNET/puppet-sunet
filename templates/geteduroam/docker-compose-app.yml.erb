services:
  app:
    image: docker.sunet.se/geteduroam-app:<%= @app_tag %>
<% unless @resolvers.empty? -%>
    dns:
<% @resolvers.each do |resolver| -%>
      - <%= resolver %>
<% end -%>
<% end -%>
    ports:
      - '443:443'
    volumes:
      - "/etc/ssl/private/:/etc/ssl/private/:ro"
      - "/opt/geteduroam/var:/var/www/var:rw"
      - "/opt/geteduroam/cert:/var/www/cert:ro"
      - "/opt/geteduroam/config/letswifi.conf.php:/var/www/etc/letswifi.conf.php:ro"
      - "/opt/geteduroam/config/config.php:/var/www/simplesamlphp/config/config.php:ro"
      - "/opt/geteduroam/config/authsources.php:/var/www/simplesamlphp/config/authsources.php:ro"

  haproxy:
    image: haproxy:<%= @haproxy_tag %>
    ports:
      - 3306:3306
    volumes:
      - "/opt/geteduroam/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg"
