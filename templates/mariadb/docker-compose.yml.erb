version: '3'

services:

  db:
    image: <%= @image %> 
    restart: always
    volumes:
      - /opt/mariadb/backups:/backups
      - /opt/mariadb/conf:/etc/mysql/mariadb.conf.d
      - /opt/mariadb/datadir:/var/lib/mysql
      - /opt/mariadb/init:/docker-entrypoint-initdb.d
      - /opt/mariadb/scripts:/scripts
    ports:
      - "3306:3306"
      - "4444:4444"
      - "4567:4567"
      - "4568:4568"
    dns:
      - 89.32.32.32
    environment: 
      - MYSQL_ROOT_PASSWORD=<%= @mysql_root_password %>
      - FORCE_BOOTSTRAP=0
    user: "999:999"
    command:  "--wsrep_cluster_address=gcomm://<%= @wsrep_cluster_address %>"
    entrypoint:  "/scripts/entrypoint.sh"
    tty: true

