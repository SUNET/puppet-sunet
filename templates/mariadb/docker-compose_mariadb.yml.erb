version: '3'

services:

  db:
    image:  docker.sunet.se/drive/mariadb:<%= @mariadb_version %>
    restart: always
    volumes:
      - /opt/mariadb/backups:/backups
      - /opt/mariadb/conf:/etc/mysql/mariadb.conf.d
      - /opt/mariadb/datadir:/var/lib/mysql
      - /opt/mariadb/init:/docker-entrypoint-initdb.d
      - /opt/mariadb/scripts:/scripts
    network_mode: host
    dns:
      - 89.32.32.32
    environment:
      - MYSQL_ROOT_PASSWORD=<%= @mysql_root_password %>
      - BOOTSTRAP=<%= @bootstrap %>
      - FORCE_BOOTSTRAP=0
    command:  "--wsrep_cluster_address=gcomm://<%= @cluster_nodes.join(',') %>"
    tty: true

