version: '3.2'
volumes:
    s3_vol:
      driver: sapk/plugin-rclone
      driver_opts:
        config: "<%= @s3_config %>"
        remote: "document-share:onlyoffice/data"
services:
    document-server:
      image: <%= @docker_image %>:<%= @docker_tag %>
      networks:
        - default
<% if @external_network -%>
        - <%= @external_network %>
<% end -%>
      dns:
        - 89.32.32.32
      ports:
        - "<%= @port %>:80"
        - "<%= @tls_port %>:443"
        - "8000:8000"
      volumes:
        - "<%= @basedir %>/run-document-server.sh:/app/ds/run-document-server.sh"
        - "<%= @basedir %>/logs:/var/log/onlyoffice"
        - "s3_vol:/var/www/onlyoffice/Data"
        - "<%= @basedir %>/lib:/var/lib/onlyoffice"
      environment:
        <%- @ds_environment.each do |environ| -%>
        - "<%= environ %>"
        <%- end -%>
      restart: always
<% if @external_network -%>
networks:
  <%= @external_network %>:
    external: true
<% end -%>
