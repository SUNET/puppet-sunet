# Enable the HTTP protocol on port <%= @port %> (1094 is the default XRootD port)
xrd.protocol http:<%= @port %> libXrdHttp.so

# Allow access to path with given prefix.
all.export  <%= @export %>

# Setting up S3 plugin
ofs.osslib libXrdS3-5.so

# Upon last testing, the plugin did not yet work in async mode
xrootd.async off

# Bucket specific s3 options
<% if @config['buckets'].length > 1 -%>
<% @config['buckets'].each do |bucket| -%>
# these must be in this order to allow parsing of multiple entries
s3.begin
s3.url_style        path
s3.path_name        /<%= bucket['name']%>
s3.bucket_name      <%= bucket['name']%>
s3.service_name     <%= bucket['service_name']%>
s3.region           <%= bucket['region']%>
s3.access_key_file  /etc/xrootd/<%= bucket['name']%>/access-key
s3.secret_key_file  /etc/xrootd/<%= bucket['name']%>/secret-key
s3.service_url      <%= bucket['service_url']%>
s3.end
<% end -%>
<% else -%>
# You must configure at least one bucket hiera
# buckets:
#   - name: my_bucket # bucket name
#     url_style: path # path or virtual
#     path_name: / # this is the path where it will be available on the xrootd side
#     service_name: s3.sto4.safedc.net 
#     region: sto4 # region
#     access_key: <access_key> # access key
#     secret_key: <secret_key> # secret key
#     service_url: https://s3.sto4.safedc.net # service url 
<% end -%>

# Global s3 options
s3.url_style path
# Debugging
# s3.trace all
# xrd.trace    all
# xrootd.trace all dump
