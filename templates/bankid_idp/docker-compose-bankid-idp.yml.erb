version: '3.2'

services:
  pyff:
    image: docker.sunet.se/bankid-idp:<%= @imagetag %>
<% unless @resolvers.empty? -%>
    dns:
<% @resolvers.each do |resolver| -%>
      - <%= resolver %>
<% end -%>
<% end -%>
    environment:
      - TZ=<%= @tz %>
      - SPRING_PROFILES_ACTIVE=<%= @spring_profiles_active %>
      - SERVER_SERVLET_CONTEXT_PATH=<%= @server_servlet_context_path %>
      - SAML_IDP_BASE_URL=<%= @saml_idp_base_url %>
      - SPRING_CONFIG_IMPORT=<%= @bankid_home %><%= @spring_config_import %>
<% @environments_extras.each do |environment| -%>
      - <%= environment %>
<% end -%>
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - "/opt/bankidp:<%= @bankid_home %>"
<%- @volumes.each do |extra_volume| -%>
      - "<%= extra_volume %>"
<%- end -%>
<% unless @ports.empty? -%>
    ports:
<%- @ports.each do |port| -%>
      - "<%= port %>"
<%- end -%>
<% end -%>
