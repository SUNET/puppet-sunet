* sample dsm.sys for SafeDC

SERVERNAME SafeDC
  *** Copy and Paste Information from Safespring Backup Portal ***

  NODENAME <%= @nodename %>
  TCPSERVERADDRESS <%= @tcpserveraddress %>
  TCPPORT 1600

  *** Copy and Paste Information from Safespring Backup Portal ***

  COMMMETHOD         V6TCPIP
*  legacy clients may have to use TCPIP
* COMMMETHOD         TCPIP
  SSL                yes
  SSLREQUIRED        yes
  PASSWORDACCESS     GENERATE
  MANAGEDSERVICES    SCHEDULE
  VIRTUALMOUNTPOINT  /dev
  SCHEDLOGRETENTION  28
  SCHEDLOGNAME       /var/log/dsmsched.log
  ERRORLOGRETENTION  28
  ERRORLOGNAME       /var/log/dsmerror.log
  SCHEDCMDDISABLED   yes
  SCHEDCMDEXCEPTION  "tbmr_license"
  SCHEDCMDEXCEPTION  "db_full"
  SCHEDCMDEXCEPTION  "db_incr"
  SCHEDCMDEXCEPTION  "mail_full"
  SCHEDCMDEXCEPTION  "mail_incr"
  SCHEDCMDEXCEPTION  "client_maintenance"
  SCHEDRESTRETRDISABLED   yes
  SRVPREPOSTSCHEDDISABLED yes
  SRVPREPOSTSNAPDISABLED  yes

  REVOKEREMOTEACCESS Access
  TESTFLAG disable_tls13

** SUNET specific settings

* 'save' is the default but lets make sure it is what we use
  ENCRYPTKey save

* We need to make sure we encrypt everything by default, this is how it worked in Safespring Backup 1.0
* The filter used to "match all files" from:
* https://www.ibm.com/docs/en/tsmfsm/7.1.0?topic=SSSR2R_7.1.0/com.ibm.itsm.client.develop.doc/c_encryp_transp.htm
  include.encrypt /.../*

<% if @backup_dirs_transformed -%>
* Since the puppet class is executed with backup_dirs
* we only include those directories and exclude
* everything else (the default is to backup everything).
* From: https://www.ibm.com/docs/en/tsm/7.1.2?topic=client-creating-include-exclude-list
* ===
* "Tivoli Storage Manager evaluates all exclude.fs and exclude.dir statements
* first (regardless of their position within the include-exclude list), and
* removes the excluded file spaces, directories, and files from the list of
* objects available for processing. All other include-exclude statements are
* processed from the bottom of the list up. Therefore, it is important to enter
* all your include-exclude statements in the proper order."
* ===
* ... so we need to exclude everything at the top of the list and then include
* the requested directories afterwards.
  exclude /.../*
  <% @backup_dirs_transformed.each do |dir| -%>
  include <%= dir %>/.../*
  <% end -%>
<% end -%>
