---
version: '3'
services:

  server:
    image: '<%= @docker_image %>:<%= @docker_tag %>'
    restart: always
    ports:
      - <%= @public_port %>:6379
    volumes:
      - <%= @basedir %>/etc/redis-server.conf:/etc/redis/redis-server.conf
      - <%= @basedir %>/data:/data
      - /etc/passwd:/etc/passwd:ro
      - /etc/group:/etc/group:ro
    environment:
      - "cfg_file=/etc/redis/redis-server.conf"

  sentinel:
    image: '<%= @docker_image %>:<%= @docker_tag %>'
    depends_on:
      - server
    restart: always
    ports:
      - <%= @sentinel_port %>:26379
    volumes:
      - <%= @basedir %>/etc/redis-sentinel.conf:/etc/redis/redis-sentinel.conf
      - /etc/passwd:/etc/passwd:ro
      - /etc/group:/etc/group:ro
      - 'sentinel_data:/data'
    environment:
      - "cfg_file=/etc/redis/redis-sentinel.conf"
      - "extra_args=--sentinel"

volumes:
  sentinel_data:

# Provide user-friendly name of bridge interface
networks:
  default:
    driver_opts:
      com.docker.network.bridge.name: br-redis
